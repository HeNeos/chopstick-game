<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chopsticks Game</title>
    <style>
        /* --- Basic Setup --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f4f7f9;
            color: #333;
            margin: 0;
            padding: 1rem;
            box-sizing: border-box;
        }

        /* --- Game Container --- */
        #game-board {
            width: 90%;
            max-width: 700px; /* Slightly wider to accommodate hands better */
            background: #ffffff;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        #game-status {
            font-size: 0.8rem;
            font-weight: bold;
            color: #3498db;
            margin: 1rem 0;
            min-height: 2.5rem;
            transition: color 0.3s;
        }

        /* --- Player Areas --- */
        .player-area {
            border: 3px solid #ddd;
            padding: 1rem; /* Reduced padding to make room for hands */
            margin: 1.5rem 0;
            border-radius: 10px;
            min-height: 180px;
            transition: all 0.3s ease-in-out;
        }

        .player-area.active {
            border-color: #3498db;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);
            transform: scale(1.02);
        }

        .player-area h2 {
            margin-top: 0;
            color: #7f8c8d;
        }

        .hands-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem; /* Reduced gap between hands */
            min-height: 120px;
            flex-wrap: wrap;
        }

        /* --- Hand Styling with SVG --- */
        .hand {
            width: 120px; /* Size for the SVG hand container */
            height: 140px;
            position: relative;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease-in-out;
            display: flex; /* To center the split button */
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .hand:hover {
            transform: translateY(-5px);
        }

        /* .hand.selected { */
        /*     outline: 4px solid #e74c3c; */
        /*     outline-offset: 4px; */
        /*     border-radius: 15px; */
        /*     box-shadow: 0 0 20px rgba(231, 76, 60, 0.7); */
        /*     transform: scale(1.05) translateY(-5px); */
        /* } */
        
        .hand.non-interactive {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .hand-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1; /* Place SVG behind text/button */
        }

        .hand-sprite {
          width: 128px;
          height: 128px;
          background-image: url("assets/hands.png");
          background-repeat: no-repeat;
          background-size: 640px 640px;
          image-rendering: pixelated;
          transform-origin: center;
          transition: transform 0.2s ease;
        }

        .hand.selected {
          transform: scale(1.1);
          filter: drop-shadow(0 0 5px yellow);
        }

        .palm {
            fill: #ffebcd;
            stroke: #34495e;
            stroke-width: 2;
        }

        .finger {
            fill: #ffebcd;
            stroke: #34495e;
            stroke-width: 4; 
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            transform-origin: center bottom;
            opacity: 1;
            transition: transform 0.4s ease, opacity 0.3s ease;
        }

        .finger.folded {
            transform: translateY(30px) scaleY(0.5);
            opacity: 0.5;
            stroke: #c9b09a;
            fill: #c9b09a;
        }

        .hand-fingers-text { /* Optional text for debugging/clarity */
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2rem;
            font-weight: bold;
            color: #34495e;
            z-index: 2;
        }

        /* --- Buttons --- */
        #controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .action-button {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: bold;
            color: #fff;
            background-color: #2ecc71;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            z-index: 3; /* Ensure button is clickable */
            position: relative;
        }
        
        .action-button:hover {
            background-color: #27ae60;
        }
        
        #restart-btn {
            background-color: #95a5a6;
        }
        #restart-btn:hover {
            background-color: #7f8c8d;
        }
        #mode-switch-btn {
            background-color: #3498db;
        }
        #mode-switch-btn:hover {
            background-color: #2980b9;
        }

        .hand .action-button { /* Styling for the split button inside hand */
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            background-color: #f39c12;
        }
        .hand .action-button:hover {
            background-color: #e67e22;
        }

    </style>
</head>
<body>

    <div id="game-board">
        <h1>Chopsticks Game</h1>
        
        <div id="game-status">Loading...</div>

        <div class="player-area" id="player2-area">
            <h2 id="player2-name">Opponent</h2>
            <div class="hands-container" id="player2-hands"></div>
        </div>

        <div class="player-area" id="player1-area">
            <h2 id="player1-name">You</h2>
            <div class="hands-container" id="player1-hands"></div>
        </div>

        <div id="controls">
            <button id="restart-btn" class="action-button">Restart Game</button>
            <button id="mode-switch-btn" class="action-button">Play vs Human</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const statusDisplay = document.getElementById('game-status');
            const player1HandsContainer = document.getElementById('player1-hands');
            const player2HandsContainer = document.getElementById('player2-hands');
            const player1Area = document.getElementById('player1-area');
            const player2Area = document.getElementById('player2-area');
            const player1Name = document.getElementById('player1-name');
            const player2Name = document.getElementById('player2-name');
            const restartBtn = document.getElementById('restart-btn');
            const modeSwitchBtn = document.getElementById('mode-switch-btn');

            // --- Game State ---
            let gameState = {};

            function initializeGame() {
                // Set default mode if not already set
                if (gameState.gameMode === undefined) {
                    gameState.gameMode = 'pvc'; // 'pvc' (Player vs Computer) or 'pvp' (Player vs Player)
                }

                gameState.players = {
                    player1: { name: 'Player 1', hands: [1, 1] },
                    player2: { name: 'Player 2', hands: [1, 1] }
                };
                
                // Set player names based on game mode
                if (gameState.gameMode === 'pvc') {
                    gameState.players.player1.name = 'You';
                    gameState.players.player2.name = 'Computer';
                    modeSwitchBtn.textContent = 'Play vs Human';
                } else {
                    gameState.players.player1.name = 'Player 1';
                    gameState.players.player2.name = 'Player 2';
                    modeSwitchBtn.textContent = 'Play vs Computer';
                }

                gameState.currentPlayerKey = 'player1';
                gameState.selectedHand = null;
                gameState.gameOver = false;
                gameState.message = `${gameState.players.player1.name}'s Turn! Select one of your hands.`;
                
                updateDisplay();
            }

            // --- Core Game Logic ---
            function performAttack(attackerKey, attackingHandIndex, defenderKey, defendingHandIndex) {
                const attacker = gameState.players[attackerKey];
                const defender = gameState.players[defenderKey];
                const attackValue = attacker.hands[attackingHandIndex];

                const totalFingers = defender.hands[defendingHandIndex] + attackValue;
                defender.hands[defendingHandIndex] = totalFingers % 5;
                
                // Filter out defeated hands (value is 0)
                attacker.hands = attacker.hands.filter(hand => hand > 0);
                defender.hands = defender.hands.filter(hand => hand > 0);

                switchTurn();
            }

            function performSplit(playerKey, handIndex) {
                const player = gameState.players[playerKey];
                const fingersToSplit = player.hands[handIndex];
                if (fingersToSplit % 2 === 0 && player.hands.length === 1 && fingersToSplit > 0) {
                    const newHandValue = fingersToSplit / 2;
                    player.hands = [newHandValue, newHandValue];
                    switchTurn();
                } else {
                    // This case should ideally be prevented by button visibility
                    console.warn("Invalid split attempt.");
                    gameState.message = "Invalid split. You can only split a single even hand.";
                    updateDisplay();
                }
            }

            function switchTurn() {
                gameState.selectedHand = null;
                if (checkGameOver()) return;
                
                gameState.currentPlayerKey = (gameState.currentPlayerKey === 'player1') ? 'player2' : 'player1';
                const currentPlayerName = gameState.players[gameState.currentPlayerKey].name;
                
                if (gameState.gameMode === 'pvc' && gameState.currentPlayerKey === 'player2') {
                    gameState.message = `${currentPlayerName}'s Turn...`;
                    updateDisplay();
                    setTimeout(computerMove, 1200);
                } else {
                    gameState.message = `${currentPlayerName}'s Turn! Select a hand.`;
                    updateDisplay();
                }
            }

            function checkGameOver() {
                const p1 = gameState.players.player1;
                const p2 = gameState.players.player2;

                if (p1.hands.length === 0) {
                    gameState.gameOver = true;
                    gameState.message = `${p2.name} Wins! 🎉`;
                } else if (p2.hands.length === 0) {
                    gameState.gameOver = true;
                    gameState.message = `${p1.name} Wins! 🎉`;
                }
                
                if (gameState.gameOver) updateDisplay();
                return gameState.gameOver;
            }

            // --- Computer AI ---
            function computerMove() {
                if (gameState.gameOver) return;
                const computer = gameState.players.player2;
                const human = gameState.players.player1;

                if (computer.hands.length === 0 || human.hands.length === 0) {
                    switchTurn(); // Game should already be over, but as a failsafe
                    return;
                }

                // AI Logic: Prioritize splitting if possible and beneficial, otherwise attack
                const canSplit = computer.hands.length === 1 && computer.hands[0] > 0 && computer.hands[0] % 2 === 0;

                if (canSplit) {
                    // Simple AI: always split if possible and it's a "good" split (e.g., 4 -> 2,2)
                    // If the only hand is 2 or 4, splitting might be good.
                    if (computer.hands[0] === 2 || computer.hands[0] === 4) {
                        performSplit('player2', 0); // Always split the first (only) hand
                        return;
                    }
                }
                
                // If no good split or not possible, then attack
                const computerHandIndex = Math.floor(Math.random() * computer.hands.length);
                const humanHandIndex = Math.floor(Math.random() * human.hands.length);
                performAttack('player2', computerHandIndex, 'player1', humanHandIndex);
            }

            // --- UI and Display Logic ---

            function createHandElement(ownerKey, index, value) {
                const handDiv = document.createElement('div');
                handDiv.classList.add('hand');

                const isLeft = (ownerKey === 'player1' && index === 0) || (ownerKey === 'player2' && index === 1);
                if (isLeft) handDiv.classList.add('left');

                // Choose a color row per player (0–4)
                const colorRow = ownerKey === 'player1' ? 2 : 3; // example: player1 blue, player2 green

                // Each frame size (since sprite is 160x160 and 5x5 grid)
                const frameWidth = 128;
                const frameHeight = 128;

                // Calculate background position
                const bgX = (-value + 1) * frameWidth;
                const bgY = -colorRow * frameHeight;

                // handSprite.style.width = `${frameWidth * scale}px`;
                // handSprite.style.height = `${frameHeight * scale}px`;
                // handSprite.style.backgroundSize = `${160 * scale}px ${160 * scale}px`;

                const handSprite = document.createElement('div');
                handSprite.classList.add('hand-sprite');
                handSprite.style.backgroundPosition = `${bgX}px ${bgY}px`;

                handDiv.appendChild(handSprite);

                // Add click interaction if applicable
                const isComputerTurn = gameState.gameMode === 'pvc' && gameState.currentPlayerKey === 'player2';
                if (!gameState.gameOver && !isComputerTurn) {
                    handDiv.onclick = () => handleHandClick(ownerKey, index);
                } else {
                    handDiv.classList.add('non-interactive');
                }

                if (gameState.selectedHand && gameState.selectedHand.ownerKey === ownerKey && gameState.selectedHand.index === index) {
                    handDiv.classList.add('selected');
                }

                // Handle splitting logic
                const player = gameState.players[ownerKey];
                const canSplit = player.hands.length === 1 && value > 0 && value % 2 === 0;

                if (ownerKey === gameState.currentPlayerKey && canSplit) {
                    const splitBtn = document.createElement('button');
                    splitBtn.textContent = 'Split';
                    splitBtn.classList.add('action-button');
                    splitBtn.onclick = (e) => {
                        e.stopPropagation();
                        performSplit(ownerKey, index);
                    };
                    handDiv.appendChild(splitBtn);
                }

                return handDiv;
            }



            // function createHandElement(ownerKey, index, value) {
            //     const handDiv = document.createElement('div');
            //     handDiv.classList.add('hand');
            //
            //     // Create SVG for the hand
            //     const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            //     svg.setAttribute('class', 'hand-svg');
            //     svg.setAttribute('viewBox', '0 0 120 140'); // Adjust viewBox for better fit
            //     svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');
            //
            //     // Palm (simple rounded rectangle)
            //     const palm = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            //     palm.setAttribute('x', '20');
            //     palm.setAttribute('y', '70');
            //     palm.setAttribute('width', '80');
            //     palm.setAttribute('height', '60');
            //     palm.setAttribute('rx', '15');
            //     palm.setAttribute('ry', '15');
            //     palm.classList.add('palm');
            //     svg.appendChild(palm);
            //
            //     // Fingers (position from left to right, adjusted for hand shape)
            //     const fingerPositions = [
            //         { x: 70, y: 15, width: 12, height: 60 }, // Index
            //         { x: 55, y: 10, width: 14, height: 65 }, // Middle
            //         { x: 40, y: 15, width: 12, height: 60 }, // Ring
            //         { x: 25, y: 30, width: 10, height: 45 }, // Pinky
            //         { x: 85, y: 40, width: 10, height: 35 }  // Thumb (shorter, to the side)
            //     ];
            //
            //     for (let i = 0; i < 5; i++) {
            //         const finger = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            //         finger.setAttribute('x', fingerPositions[i].x);
            //         finger.setAttribute('y', fingerPositions[i].y);
            //         finger.setAttribute('width', fingerPositions[i].width);
            //         finger.setAttribute('height', fingerPositions[i].height);
            //         finger.setAttribute('rx', '5');
            //         finger.setAttribute('ry', '5');
            //         finger.classList.add('finger');
            //         if (i >= value) {
            //             finger.classList.add('folded');
            //         }
            //         svg.appendChild(finger);
            //     }
            //
            //     handDiv.appendChild(svg);
            //
            //     const isComputerTurn = gameState.gameMode === 'pvc' && gameState.currentPlayerKey === 'player2';
            //     if (!gameState.gameOver && !isComputerTurn) {
            //         handDiv.onclick = () => handleHandClick(ownerKey, index);
            //     } else {
            //         handDiv.classList.add('non-interactive');
            //     }
            //
            //     if (gameState.selectedHand && gameState.selectedHand.ownerKey === ownerKey && gameState.selectedHand.index === index) {
            //         handDiv.classList.add('selected');
            //     }
            //
            //     const player = gameState.players[ownerKey];
            //     const canSplit = player.hands.length === 1 && value > 0 && value % 2 === 0;
            //
            //     if (ownerKey === gameState.currentPlayerKey && canSplit) {
            //         const splitBtn = document.createElement('button');
            //         splitBtn.textContent = 'Split';
            //         splitBtn.classList.add('action-button');
            //         splitBtn.onclick = (e) => {
            //             e.stopPropagation();
            //             performSplit(ownerKey, index);
            //         };
            //         handDiv.appendChild(splitBtn);
            //     }
            //
            //     return handDiv;
            // }
            
            function updateDisplay() {
                statusDisplay.textContent = gameState.message;
                
                player1HandsContainer.innerHTML = '';
                player2HandsContainer.innerHTML = '';
                
                player1Name.textContent = gameState.players.player1.name;
                player2Name.textContent = gameState.players.player2.name;

                player1Area.classList.toggle('active', gameState.currentPlayerKey === 'player1' && !gameState.gameOver);
                player2Area.classList.toggle('active', gameState.currentPlayerKey === 'player2' && !gameState.gameOver);

                gameState.players.player1.hands.forEach((val, i) => {
                    player1HandsContainer.appendChild(createHandElement('player1', i, val));
                });
                gameState.players.player2.hands.forEach((val, i) => {
                    player2HandsContainer.appendChild(createHandElement('player2', i, val));
                });
            }

            function handleHandClick(ownerKey, index) {
                if (gameState.currentPlayerKey === 'player2' && gameState.gameMode === 'pvc') return;
                if (gameState.gameOver) return;

                if (ownerKey === gameState.currentPlayerKey) {
                    gameState.selectedHand = { ownerKey, index };
                    gameState.message = `Selected hand with ${gameState.players[ownerKey].hands[index]} fingers. Now, select an opponent's hand to attack.`;
                } 
                else if (gameState.selectedHand && gameState.selectedHand.ownerKey === gameState.currentPlayerKey) {
                    performAttack(
                        gameState.selectedHand.ownerKey, 
                        gameState.selectedHand.index, 
                        ownerKey,
                        index
                    );
                } else {
                    gameState.message = "Please select one of your own hands first.";
                }
                updateDisplay();
            }

            function switchGameMode() {
                gameState.gameMode = (gameState.gameMode === 'pvc') ? 'pvp' : 'pvc';
                initializeGame();
            }

            restartBtn.addEventListener('click', initializeGame);
            modeSwitchBtn.addEventListener('click', switchGameMode);

            initializeGame();
        });
    </script>
</body>
</html>
